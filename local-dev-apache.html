<!DOCTYPE html>
<html>
<head>

    <!-- Document Settings -->
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <!-- Base Meta -->
    <!-- dynamically fixing the title for tag/author pages -->



    <title>Apache HTTPD local reverse proxy</title>
    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Styles'n'Scripts -->
    <link rel="stylesheet" type="text/css" href="/blog/assets/built/screen.css" />
    <link rel="stylesheet" type="text/css" href="/blog/assets/built/screen.edited.css" />
    <link rel="stylesheet" type="text/css" href="/blog/assets/built/syntax.css" />
    <!-- highlight.js -->
    <link rel="stylesheet" href="/blog/assets/built/highlight.min.css">
    <style>.hljs { background: none; }</style>

    <!--[if IE]>
        <style>
            p, ol, ul{
                width: 100%;
            }
            blockquote{
                width: 100%;
            }
        </style>
    <![endif]-->
    
    <!-- This tag outputs SEO meta+structured data and other important settings -->
    <meta name="description" content="Technical blog from the CorpsMap team" />
    <link rel="shortcut icon" href="/blog/assets/images/corpsmap-logo.png" type="image/png" />
    <link rel="canonical" href="/blog/local-dev-apache" />
    <meta name="referrer" content="no-referrer-when-downgrade" />

     <!--title below is coming from _includes/dynamic_title-->
    <meta property="og:site_name" content="CorpsMap Blog" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="Apache HTTPD local reverse proxy" />
    <meta property="og:description" content="You might be asking yourself “what is a local reverse proxy and why would I need one?”, if so, great! That’s what we’re going to cover today. This is the first in a series of posts I’m using to document my local development setup using Docker-Compose to orchestrate all the" />
    <meta property="og:url" content="/blog/local-dev-apache" />
    <meta property="og:image" content="/blog/assets/images/apache-small.jpg" />
    <meta property="article:publisher" content="https://www.facebook.com/false" />
    <meta property="article:author" content="https://www.facebook.com/false" />
    <meta property="article:published_time" content="2024-02-20T10:00:00+00:00" />
    <meta property="article:modified_time" content="2024-02-20T10:00:00+00:00" />
    <meta property="article:tag" content="Local Dev" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Apache HTTPD local reverse proxy" />
    <meta name="twitter:description" content="You might be asking yourself “what is a local reverse proxy and why would I need one?”, if so, great! That’s what we’re going to cover today. This is the first in a series of posts I’m using to document my local development setup using Docker-Compose to orchestrate all the" />
    <meta name="twitter:url" content="/blog/" />
    <meta name="twitter:image" content="/blog/assets/images/apache-small.jpg" />
    <meta name="twitter:label1" content="Written by" />
    <meta name="twitter:data1" content="CorpsMap Blog" />
    <meta name="twitter:label2" content="Filed under" />
    <meta name="twitter:data2" content="Local Dev" />
    <meta name="twitter:site" content="@false" />
    <meta name="twitter:creator" content="@false" />
    <meta property="og:image:width" content="1400" />
    <meta property="og:image:height" content="933" />

    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Website",
    "publisher": {
        "@type": "Organization",
        "name": "CorpsMap Blog",
        "logo": "/blog/assets/images/corpsmap-logo.png"
    },
    "url": "/blog/local-dev-apache",
    "image": {
        "@type": "ImageObject",
        "url": "/blog/assets/images/apache-small.jpg",
        "width": 2000,
        "height": 666
    },
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "/blog/local-dev-apache"
    },
    "description": "You might be asking yourself “what is a local reverse proxy and why would I need one?”, if so, great! That’s what we’re going to cover today. This is the first in a series of posts I’m using to document my local development setup using Docker-Compose to orchestrate all the"
}
    </script>

    <!-- <script type="text/javascript" src="https://demo.ghost.io/public/ghost-sdk.min.js?v=724281a32e"></script>
    <script type="text/javascript">
    ghost.init({
    	clientId: "ghost-frontend",
    	clientSecret: "f84a07a72b17"
    });
    </script> -->

    <meta name="generator" content="Jekyll 3.6.2" />
    <link rel="alternate" type="application/rss+xml" title="Apache HTTPD local reverse proxy" href="/blog/feed.xml" />


</head>
<body class="post-template">

    <div class="site-wrapper">
        <!-- All the main content gets inserted here, index.hbs, post.hbs, etc -->
        <!-- default -->

<!-- The tag above means: insert everything in this file
into the {body} of the default.hbs template -->

<header class="site-header outer">
    <div class="inner">
        <nav class="site-nav">
    <div class="site-nav-left">
        
            
                <a class="site-nav-logo" href="/blog/"><img src="/blog/assets/images/corpsmap-logo.png" alt="CorpsMap Blog" /></a>
            
        
        
            <ul class="nav" role="menu">
    <li class="nav-home" role="menuitem"><a href="/blog/">Home</a></li>
    <li class="nav-about" role="menuitem"><a href="/blog/about/">About</a></li>
</ul>

        
    </div>
    <div class="site-nav-right">
        <div class="social-links">
            
            
        </div>
        
    </div>
</nav>

    </div>
</header>

<!-- Everything inside the #post tags pulls data from the post -->
<!-- #post -->

<main id="site-main" class="site-main outer" role="main">
    <div class="inner">

        <article class="post-full  tag-local-dev post ">

            <header class="post-full-header">
                <section class="post-full-meta">
                    <time class="post-full-meta-date" datetime="20 February 2024">20 February 2024</time>
                    
                        <span class="date-divider">/</span>
                        
                            
                               <a href='/blog/tag/local-dev/'>LOCAL DEV</a>
                            
                        
                    
                </section>
                <h1 class="post-full-title">Apache HTTPD local reverse proxy</h1>
            </header>

            
            <figure class="post-full-image" style="background-image: url(/blog/assets/images/apache-small.jpg)">
            </figure>
            

            <section class="post-full-content">
                <div class="kg-card-markdown">
                    <p>You might be asking yourself “what is a local reverse proxy and why would I need one?”, if so, great! That’s what we’re going to cover today.</p>

<p>This is the first in a series of posts I’m using to document my local development setup using Docker-Compose to orchestrate all the services you would need to run a local development environment that emulates how you might be deploying your site in CWBI. This includes a number of base services that will allow you to get work done without having to be on the network with access to any of our shared resources.</p>

<p>You can use the following setup in a couple of different ways, lately I’ve been creating mono-repos with the full stack of things you would need included for each application I’m working on. You could also stand up a single instance of the shared resources like HTTPD and use them across all the apps you’re building.</p>

<p>I decided on the mono-repo approach so that it is easy to hand a project off to a new team member and get them up and running quickly.</p>

<p>Let’s do a quick overview of the local dev setup, then dive into HTTPD. We’ll add more posts to cover the other components soon.</p>

<h3 id="the-stack">The Stack</h3>

<p><strong>Basic Components</strong></p>

<ul>
  <li>Apache HTTPD - Reverse Proxy, TLS endpoint</li>
  <li>Keycloak - Authentication / Authorization</li>
  <li>Postgres - Database</li>
</ul>

<p><strong>Optional</strong> Depending on what I’m building I might include these as well:</p>

<ul>
  <li>Flyway - Can be used for more advanced things, but typically I use it to manage DB schema updates</li>
  <li>PG-Tileserv - Vector tiles out of the box for any PostGIS data in a DB</li>
  <li>PG-Featureserv - OGC Features API out of the box for any PostGIS data in a DB</li>
</ul>

<p>Let’s get into those in more detail later, for now we’ll deal with Apache HTTPD.</p>

<h2 id="httpd">HTTPD</h2>

<p>Apache HTTPD (aka Apache) is the workhorse of the internet, it’s the ol tried and true web server that the CWBI program uses to implement the WAF (Web Application Firewall) layer of our environment. That means that all requests over HTTP(s) come in through Apache and are forwarded to the respective service based on the routing rules laid out by the team.</p>

<p>This layer also acts as our TLS endpoint, that means that traffic to Apache can come in over HTTP or HTTPS (we auto upgrade requests to HTTPS by default), then the forwarded requests are handled using basic un-encrypted HTTP, but since that traffic lives only within our environment we think it works well enough. Some might argue that we should be HTTPS everywhere, but that imposes some interesting hurdles when trying to generate and rotate the certificates required to make that work.</p>

<p>Apache also handles mutual authentication, that’s a long way of saying it’ll read your CAC (Common Access Card) or PIV (Personal Identity Verification) certificates as part of the request negotiation if you tell it to. This is how we’re doing CAC/PIV based login to Keycloak. In production we specify which routes should request mutual auth, but in development I usually just set it globally.</p>

<p>In order to do mutual auth locally, we need a couple things though, we need to run in HTTPS mode, which means we need a valid HTTPS certificate that our browser can recognize so we don’t break the many browser based rules around HTTPS. Luckily we have a teammate that created his own CA that we can leverage for a local HTTPS certificate.</p>

<h2 id="setup">Setup</h2>

<p>I typically setup a project folder that contains my source for the application as well as folders for each of the services managed by Docker Compose. It will work as a single development infrastructure stack independent of the source code of your app as well.</p>

<p>So given a folder structure like:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/my-project
  /api
  /httpd
  /keycloak
  /flyway
  /ui
  /docker-compose.yml
</code></pre></div></div>

<p>Let’s set up the contents of the <code class="language-plaintext highlighter-rouge">/httpd</code> folder, then configure our <code class="language-plaintext highlighter-rouge">docker-compose.yml</code> for apache.</p>

<h3 id="dockerfile">Dockerfile</h3>

<p>The dockerfile basically just takes the off-the-shelf Apache HTTPD container and copies some of our customized files in to configure the setup.</p>

<div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">FROM</span><span class="s"> httpd:2.4</span>
<span class="k">COPY</span><span class="s"> httpd.conf /usr/local/apache2/conf/httpd.conf</span>
<span class="k">COPY</span><span class="s"> httpd-ssl.conf /usr/local/apache2/conf/extra/httpd-ssl.conf</span>
<span class="k">COPY</span><span class="s"> dev2-crrel-mil.crt /usr/local/apache2/conf/dev2-crrel-mil.crt</span>
<span class="k">COPY</span><span class="s"> dev2-crrel-mil.key /usr/local/apache2/conf/dev2-crrel-mil.key</span>
<span class="k">COPY</span><span class="s"> CRREL-CA1.crt /usr/local/apache2/conf/CRREL-CA1.crt</span>
<span class="k">COPY</span><span class="s"> trustore.crt /usr/local/apache2/conf/trustore.crt</span>
</code></pre></div></div>

<div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">FROM</span><span class="s"> httpd:2.4</span>
</code></pre></div></div>

<p>Start with the base public httpd image, version 2.4.</p>

<div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">COPY</span><span class="s"> httpd.conf /usr/local/apache2/conf/httpd.conf</span>
<span class="k">COPY</span><span class="s"> httpd-ssl.conf /usr/local/apache2/conf/extra/httpd-ssl.conf</span>
</code></pre></div></div>

<p>Copy our customized config files into the container, we’ll get into the weeds on these next.</p>

<div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">COPY</span><span class="s"> dev2-crrel-mil.crt /usr/local/apache2/conf/dev2-crrel-mil.crt</span>
<span class="k">COPY</span><span class="s"> dev2-crrel-mil.key /usr/local/apache2/conf/dev2-crrel-mil.key</span>
<span class="k">COPY</span><span class="s"> CRREL-CA1.crt /usr/local/apache2/conf/CRREL-CA1.crt</span>
<span class="k">COPY</span><span class="s"> trustore.crt /usr/local/apache2/conf/trustore.crt</span>
</code></pre></div></div>

<p>Copy our local dev certificate and CA information, this lets us run HTTPS locally. <strong>These certificates should never be used on a server.</strong></p>

<h3 id="httpdconf">httpd.conf</h3>

<p>This is the main configuration file for for HTTPD. You shouldn’t really change anything here unless you know what you’re doing.</p>

<h3 id="httpd-sslconfig">httpd-ssl.config</h3>

<p>All of the TLS config is here, this is also where we’ll define our reverse proxy endpoints pointing to our other services. Here is also where we define our mutual auth config which allows us to strip data from the CAC/PIV certificates and pass them along to our other services as headers in the proxied requests.</p>

<p><a href="/blog/local-dev-keycloak">Continue to the next post in the series -&gt;</a></p>

                </div>
            </section>

            <!-- Email subscribe form at the bottom of the page -->
            

            <footer class="post-full-footer">
                <!-- Everything inside the #author tags pulls data from the author -->
                <!-- #author-->
                
                    
                        <section class="author-card">
                            
                                <img class="author-profile-image" src="/blog/assets/images/will.jpg" alt="will" />
                            
                            <section class="author-card-content">
                                <h4 class="author-card-name"><a href="/blog/author/will">Will Breitkreutz</a></h4>
                                
                                    <p>I'm a software developer and open-source advocate within USACE.  Research Geographer at ERDC-CRREL.</p>
                                
                            </section>
                        </section>
                        <div class="post-full-footer-right">
                            <a class="author-card-button" href="/blog/author/will">Read More</a>
                        </div>
                    
                
                <!-- /author  -->
            </footer>

            <!-- If you use Disqus comments, just uncomment this block.
            The only thing you need to change is "test-apkdzgmqhj" - which
            should be replaced with your own Disqus site-id. -->
            

        </article>

    </div>
</main>

<!-- Links to Previous/Next posts -->
<aside class="read-next outer">
    <div class="inner">
        <div class="read-next-feed">
            
                
                
                
                
            

            <!-- If there's a next post, display it using the same markup included from - partials/post-card.hbs -->
            
                

    <article class="post-card post-template">
        
            <a class="post-card-image-link" href="/blog/front-end-quickstart">
                <div class="post-card-image" style="background-image: url(/blog/assets/images/excavator.jpg)"></div>
            </a>
        
        <div class="post-card-content">
            <a class="post-card-content-link" href="/blog/front-end-quickstart">
                <header class="post-card-header">
                    
                        
                            
                               <span class="post-card-tags">Groundwork</span>
                            
                        
                            
                                <span class="post-card-tags">Front-end</span>
                            
                        
                    

                    <h2 class="post-card-title">Front-end Quickstart</h2>
                </header>
                <section class="post-card-excerpt">
                    
                        <p>This guide will lead you through the process of starting up a new front-end project using the Groundwork component library and a few of our other recommended libraries. If you are not familiar,</p>
                    
                </section>
            </a>
            <footer class="post-card-meta">
                
                    
                        
                        <img class="author-profile-image" src="/blog/assets/images/will.jpg" alt="Will Breitkreutz" />
                        
                        <span class="post-card-author">
                            <a href="/blog/author/will/">Will Breitkreutz</a>
                        </span>
                    
                
                <span class="reading-time">
                    
                    
                      3 min read
                    
                </span>
            </footer>
        </div>
    </article>

            

            <!-- If there's a previous post, display it using the same markup included from - partials/post-card.hbs -->
            

        </div>
    </div>
</aside>

<!-- Floating header which appears on-scroll, included from includes/floating-header.hbs -->
<div class="floating-header">
    <div class="floating-header-logo">
        <a href="/blog/">
            
                <img src="/blog/assets/images/corpsmap-logo.png" alt="CorpsMap Blog icon" />
            
            <span>CorpsMap Blog</span>
        </a>
    </div>
    <span class="floating-header-divider">&mdash;</span>
    <div class="floating-header-title">Apache HTTPD local reverse proxy</div>
    <div class="floating-header-share">
        <div class="floating-header-share-label">Share this <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
    <path d="M7.5 15.5V4a1.5 1.5 0 1 1 3 0v4.5h2a1 1 0 0 1 1 1h2a1 1 0 0 1 1 1H18a1.5 1.5 0 0 1 1.5 1.5v3.099c0 .929-.13 1.854-.385 2.748L17.5 23.5h-9c-1.5-2-5.417-8.673-5.417-8.673a1.2 1.2 0 0 1 1.76-1.605L7.5 15.5zm6-6v2m-3-3.5v3.5m6-1v2"/>
</svg>
</div>
        <a class="floating-header-share-tw" href="https://twitter.com/share?text=Apache+HTTPD+local+reverse+proxy&amp;url=https://corpsmap.github.io/blog/local-dev-apache"
            onclick="window.open(this.href, 'share-twitter', 'width=550,height=235');return false;">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M30.063 7.313c-.813 1.125-1.75 2.125-2.875 2.938v.75c0 1.563-.188 3.125-.688 4.625a15.088 15.088 0 0 1-2.063 4.438c-.875 1.438-2 2.688-3.25 3.813a15.015 15.015 0 0 1-4.625 2.563c-1.813.688-3.75 1-5.75 1-3.25 0-6.188-.875-8.875-2.625.438.063.875.125 1.375.125 2.688 0 5.063-.875 7.188-2.5-1.25 0-2.375-.375-3.375-1.125s-1.688-1.688-2.063-2.875c.438.063.813.125 1.125.125.5 0 1-.063 1.5-.25-1.313-.25-2.438-.938-3.313-1.938a5.673 5.673 0 0 1-1.313-3.688v-.063c.813.438 1.688.688 2.625.688a5.228 5.228 0 0 1-1.875-2c-.5-.875-.688-1.813-.688-2.75 0-1.063.25-2.063.75-2.938 1.438 1.75 3.188 3.188 5.25 4.25s4.313 1.688 6.688 1.813a5.579 5.579 0 0 1 1.5-5.438c1.125-1.125 2.5-1.688 4.125-1.688s3.063.625 4.188 1.813a11.48 11.48 0 0 0 3.688-1.375c-.438 1.375-1.313 2.438-2.563 3.188 1.125-.125 2.188-.438 3.313-.875z"/></svg>

        </a>
        <a class="floating-header-share-fb" href="https://www.facebook.com/sharer/sharer.php?u=https://corpsmap.github.io/blog/local-dev-apache"
            onclick="window.open(this.href, 'share-facebook','width=580,height=296');return false;">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M19 6h5V0h-5c-3.86 0-7 3.14-7 7v3H8v6h4v16h6V16h5l1-6h-6V7c0-.542.458-1 1-1z"/></svg>

        </a>
    </div>
    <progress class="progress" value="0">
        <div class="progress-container">
            <span class="progress-bar"></span>
        </div>
    </progress>
</div>


<!-- /post -->

<!-- The #contentFor helper here will send everything inside it up to the matching #block helper found in default.hbs -->


        <!-- Previous/next page links - displayed on every page -->
        

        <!-- The footer at the very bottom of the screen -->
        <footer class="site-footer outer">
            <div class="site-footer-content inner">
                <section class="copyright"><a href="/blog/">CorpsMap Blog</a> &copy; 2024</section>
                <section class="poweredby">Proudly published with <a href="https://jekyllrb.com/">Jekyll</a> &
                    <a href="https://pages.github.com/" target="_blank" rel="noopener">GitHub Pages</a></section>
                <nav class="site-footer-nav">
                    <a href="/blog/">Latest Posts</a>
                    <a href="https://github.com/corpsmap" target="_blank" rel="noopener">CorpsMap GitHub</a>
                    <a href="https://github.com/USACE" target="_blank" rel="noopener">USACE GitHub</a>
                    <a href="https://github.com/cwbi-apps" target="_blank" rel="noopener">CWBI Apps GitHub</a>
                </nav>
            </div>
        </footer>

    </div>

    <!-- The big email subscribe modal content -->
    

    

    <!-- jQuery + Fitvids, which makes all video embeds responsive -->
    <script
        src="https://code.jquery.com/jquery-3.2.1.min.js"
        integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
        crossorigin="anonymous">
    </script>
    <script type="text/javascript" src="/blog/assets/js/jquery.fitvids.js"></script>

    <!-- highlight.js -->
    <script src="/blog/assets/js/highlight.min.js"></script>

    <!-- Paginator increased to "infinit" in _config.yml -->
    <!-- if paginator.posts  -->
    <!-- <script>
        var maxPages = parseInt('');
    </script>
    <script src="/blog/assets/js/infinitescroll.js"></script> -->
    <!-- /endif -->

    


    <!-- Add Google Analytics  -->
    <!-- Google Analytics Tracking code -->
 <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'G-1TCRZ1W9ML', 'auto');
  ga('send', 'pageview');

 </script>


    <!-- The #block helper will pull in data from the #contentFor other template files. In this case, there's some JavaScript which we only want to use in post.hbs, but it needs to be included down here, after jQuery has already loaded. -->
    
        <script>

// NOTE: Scroll performance is poor in Safari
// - this appears to be due to the events firing much more slowly in Safari.
//   Dropping the scroll event and using only a raf loop results in smoother
//   scrolling but continuous processing even when not scrolling
$(document).ready(function () {
    // Start fitVids
    var $postContent = $(".post-full-content");
    $postContent.fitVids();
    // End fitVids

    var progressBar = document.querySelector('progress');
    var header = document.querySelector('.floating-header');
    var title = document.querySelector('.post-full-title');

    var lastScrollY = window.scrollY;
    var lastWindowHeight = window.innerHeight;
    var lastDocumentHeight = $(document).height();
    var ticking = false;

    function onScroll() {
        lastScrollY = window.scrollY;
        requestTick();
    }

    function onResize() {
        lastWindowHeight = window.innerHeight;
        lastDocumentHeight = $(document).height();
        requestTick();
    }

    function requestTick() {
        if (!ticking) {
            requestAnimationFrame(update);
        }
        ticking = true;
    }

    function update() {
        var trigger = title.getBoundingClientRect().top + window.scrollY;
        var triggerOffset = title.offsetHeight + 35;
        var progressMax = lastDocumentHeight - lastWindowHeight;

        // show/hide floating header
        if (lastScrollY >= trigger + triggerOffset) {
            header.classList.add('floating-active');
        } else {
            header.classList.remove('floating-active');
        }

        progressBar.setAttribute('max', progressMax);
        progressBar.setAttribute('value', lastScrollY);

        ticking = false;
    }

    window.addEventListener('scroll', onScroll, {passive: true});
    window.addEventListener('resize', onResize, false);

    update();
});
</script>

    

    <!-- Ghost outputs important scripts and data with this tag - it should always be the very last thing before the closing body tag -->
    <!-- ghost_foot -->

</body>
</html>
